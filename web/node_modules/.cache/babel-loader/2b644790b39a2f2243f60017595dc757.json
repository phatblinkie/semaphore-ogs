{"ast":null,"code":"//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  props: {\n    vars: Array\n  },\n  watch: {\n    vars(val) {\n      this.var = val || [];\n    }\n  },\n  created() {\n    this.modifiedVars = (this.vars || []).map(v => ({\n      ...v\n    }));\n  },\n  data() {\n    return {\n      editDialog: null,\n      editedVar: null,\n      editedValues: [],\n      editedVarIndex: null,\n      modifiedVars: null,\n      varTypes: [{\n        id: '',\n        name: 'String'\n      }, {\n        id: 'int',\n        name: 'Integer'\n      }, {\n        id: 'secret',\n        name: 'Secret'\n      }, {\n        id: 'enum',\n        name: 'Enum'\n      }],\n      formError: null\n    };\n  },\n  methods: {\n    addEditedVarValue() {\n      this.editedValues.push({\n        name: '',\n        value: ''\n      });\n    },\n    removeEditedVarValue(val) {\n      const i = this.editedValues.findIndex(v => v.name === val.name);\n      if (i > -1) {\n        this.editedValues.splice(i, 1);\n      }\n    },\n    editVar(index) {\n      this.editedVar = index != null ? {\n        ...this.modifiedVars[index]\n      } : {};\n      this.editedValues = [];\n      this.editedValues.push(...(this.editedVar.values || []));\n      this.editedVar.values = this.editedValues;\n      this.editedVarIndex = index;\n      if (this.$refs.form) {\n        this.$refs.form.resetValidation();\n      }\n      this.editDialog = true;\n    },\n    saveVar() {\n      this.formError = null;\n      if (!this.$refs.form.validate()) {\n        return;\n      }\n      if (this.editedVar.type === 'enum') {\n        if (this.editedValues.length === 0) {\n          this.formError = 'Enumeration must have values.';\n          return;\n        }\n        const uniq = new Set(this.editedValues.map(v => v.name));\n        if (this.editedValues.length !== uniq.size) {\n          this.formError = 'Enumeration values must have unique names.';\n          return;\n        }\n        this.editedValues.forEach(v => {\n          if (v.name === '') {\n            this.formError = 'Value name cannot be empty.';\n          }\n        });\n        if (this.formError != null) {\n          return;\n        }\n      } else {\n        this.editedVar.values = [];\n      }\n      if (this.editedVarIndex != null) {\n        this.modifiedVars[this.editedVarIndex] = this.editedVar;\n      } else {\n        this.modifiedVars.push(this.editedVar);\n      }\n      this.editDialog = false;\n      this.editedVar = null;\n      this.$emit('change', this.modifiedVars);\n    },\n    deleteVar(index) {\n      this.modifiedVars.splice(index, 1);\n      this.$emit('change', this.modifiedVars);\n    }\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2JA;EACAA;IACAC;EACA;EACAC;IACAD;MACA;IACA;EACA;EAEAE;IACA;MAAA;IAAA;EACA;EAEAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;QACAC;QACAC;MACA;QACAD;QACAC;MACA;QACAD;QACAC;MACA;QACAD;QACAC;MACA;MACAC;IACA;EACA;EACAC;IACAC;MACA;QACAH;QACAI;MACA;IACA;IAEAC;MACA;MACA;QACA;MACA;IACA;IAEAC;MACA;QAAA;MAAA;MAEA;MACA;MACA;MAEA;MAEA;QACA;MACA;MAEA;IACA;IAEAC;MACA;MAEA;QACA;MACA;MAEA;QACA;UACA;UACA;QACA;QAEA;QAEA;UACA;UACA;QACA;QAEA;UACA;YACA;UACA;QACA;QAEA;UACA;QACA;MACA;QACA;MACA;MAEA;QACA;MACA;QACA;MACA;MAEA;MACA;MACA;IACA;IAEAC;MACA;MACA;IACA;EACA;AACA","names":["props","vars","watch","created","data","editDialog","editedVar","editedValues","editedVarIndex","modifiedVars","varTypes","id","name","formError","methods","addEditedVarValue","value","removeEditedVarValue","editVar","saveVar","deleteVar"],"sourceRoot":"src/components","sources":["SurveyVars.vue"],"sourcesContent":["<template>\n  <div class=\"pb-6\">\n    <v-dialog\n      v-model=\"editDialog\"\n      hide-overlay\n      width=\"300\"\n    >\n      <v-card :color=\"$vuetify.theme.dark ? '#212121' : 'white'\">\n        <v-card-title></v-card-title>\n        <v-card-text class=\"pb-0\">\n          <v-form\n            ref=\"form\"\n            lazy-validation\n            v-if=\"editedVar != null\"\n          >\n            <v-alert\n              :value=\"formError\"\n              color=\"error\"\n            >{{ formError }}\n            </v-alert>\n\n            <v-text-field\n              :label=\"$t('name2')\"\n              v-model.trim=\"editedVar.name\"\n              :rules=\"[(v) => !!v || $t('name_required')]\"\n              required\n            />\n\n            <v-text-field\n              :label=\"$t('title')\"\n              v-model=\"editedVar.title\"\n              :rules=\"[(v) => !!v || $t('title_required')]\"\n              required\n            />\n\n            <v-text-field\n              :label=\"$t('description')\"\n              v-model=\"editedVar.description\"\n              required\n            />\n            <v-select\n              v-model=\"editedVar.type\"\n              :label=\"$t('type')\"\n              :items=\"varTypes\"\n              item-value=\"id\"\n              item-text=\"name\"\n            ></v-select>\n\n            <v-data-table\n              v-if=\"editedVar.type === 'enum'\"\n              :items=\"editedValues\"\n              :items-per-page=\"-1\"\n              class=\"elevation-1\"\n              hide-default-footer\n              no-data-text=\"No values\"\n            >\n              <template v-slot:item=\"props\">\n                <tr>\n                  <td class=\"pa-1\">\n                    <v-text-field\n                      solo-inverted\n                      flat\n                      hide-details\n                      v-model=\"props.item.name\"\n                      class=\"v-text-field--solo--no-min-height\"\n                    ></v-text-field>\n                  </td>\n                  <td class=\"pa-1\">\n                    <v-text-field\n                      solo-inverted\n                      flat\n                      hide-details\n                      v-model=\"props.item.value\"\n                      class=\"v-text-field--solo--no-min-height\"\n                    ></v-text-field>\n                  </td>\n                  <td style=\"width: 38px;\">\n                    <v-icon\n                      small\n                      class=\"pa-1\"\n                      @click=\"removeEditedVarValue(props.item)\"\n                    >\n                      mdi-delete\n                    </v-icon>\n                  </td>\n                </tr>\n              </template>\n            </v-data-table>\n\n            <div class=\"text-right mt-2\">\n\n              <v-btn\n                color=\"primary\"\n                v-if=\"editedVar.type === 'enum'\"\n                @click=\"addEditedVarValue()\"\n              >Add Value</v-btn>\n            </div>\n\n            <v-checkbox\n              :label=\"$t('required')\"\n              v-model=\"editedVar.required\"\n            />\n          </v-form>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn\n            color=\"blue darken-1\"\n            text\n            @click=\"editDialog = false\"\n          >\n            {{ $t('cancel') }}\n          </v-btn>\n          <v-btn\n            color=\"blue darken-1\"\n            text\n            @click=\"saveVar()\"\n          >\n            {{ editedVarIndex == null ? $t('add') : $t('save') }}\n          </v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-dialog>\n    <fieldset style=\"padding: 0 10px 2px 10px;\n                     border: 1px solid rgba(0, 0, 0, 0.38);\n                     border-radius: 4px;\n                     font-size: 12px;\"\n              :style=\"{\n                       'border-color': $vuetify.theme.dark ?\n                         'rgba(200, 200, 200, 0.38)' :\n                         'rgba(0, 0, 0, 0.38)'\n                     }\">\n      <legend style=\"padding: 0 3px;\">{{ $t('surveyVariables') }}</legend>\n      <v-chip-group column style=\"margin-top: -4px;\">\n        <v-chip\n          v-for=\"(v, i) in modifiedVars\"\n          close\n          @click:close=\"deleteVar(i)\"\n          :key=\"v.name\"\n          @click=\"editVar(i)\"\n          :color=\"v.type === 'int' ? '#61e2ff' : 'gray'\"\n        >\n          {{ v.title }}\n        </v-chip>\n        <v-chip @click=\"editVar(null)\">\n          + <span class=\"ml-1\" v-if=\"modifiedVars.length === 0\">{{ $t('addVariable') }}</span>\n        </v-chip>\n      </v-chip-group>\n    </fieldset>\n  </div>\n</template>\n<style lang=\"scss\">\n\n</style>\n<script>\nexport default {\n  props: {\n    vars: Array,\n  },\n  watch: {\n    vars(val) {\n      this.var = val || [];\n    },\n  },\n\n  created() {\n    this.modifiedVars = (this.vars || []).map((v) => ({ ...v }));\n  },\n\n  data() {\n    return {\n      editDialog: null,\n      editedVar: null,\n      editedValues: [],\n      editedVarIndex: null,\n      modifiedVars: null,\n      varTypes: [{\n        id: '',\n        name: 'String',\n      }, {\n        id: 'int',\n        name: 'Integer',\n      }, {\n        id: 'secret',\n        name: 'Secret',\n      }, {\n        id: 'enum',\n        name: 'Enum',\n      }],\n      formError: null,\n    };\n  },\n  methods: {\n    addEditedVarValue() {\n      this.editedValues.push({\n        name: '',\n        value: '',\n      });\n    },\n\n    removeEditedVarValue(val) {\n      const i = this.editedValues.findIndex((v) => v.name === val.name);\n      if (i > -1) {\n        this.editedValues.splice(i, 1);\n      }\n    },\n\n    editVar(index) {\n      this.editedVar = index != null ? { ...this.modifiedVars[index] } : {};\n\n      this.editedValues = [];\n      this.editedValues.push(...(this.editedVar.values || []));\n      this.editedVar.values = this.editedValues;\n\n      this.editedVarIndex = index;\n\n      if (this.$refs.form) {\n        this.$refs.form.resetValidation();\n      }\n\n      this.editDialog = true;\n    },\n\n    saveVar() {\n      this.formError = null;\n\n      if (!this.$refs.form.validate()) {\n        return;\n      }\n\n      if (this.editedVar.type === 'enum') {\n        if (this.editedValues.length === 0) {\n          this.formError = 'Enumeration must have values.';\n          return;\n        }\n\n        const uniq = new Set(this.editedValues.map((v) => v.name));\n\n        if (this.editedValues.length !== uniq.size) {\n          this.formError = 'Enumeration values must have unique names.';\n          return;\n        }\n\n        this.editedValues.forEach((v) => {\n          if (v.name === '') {\n            this.formError = 'Value name cannot be empty.';\n          }\n        });\n\n        if (this.formError != null) {\n          return;\n        }\n      } else {\n        this.editedVar.values = [];\n      }\n\n      if (this.editedVarIndex != null) {\n        this.modifiedVars[this.editedVarIndex] = this.editedVar;\n      } else {\n        this.modifiedVars.push(this.editedVar);\n      }\n\n      this.editDialog = false;\n      this.editedVar = null;\n      this.$emit('change', this.modifiedVars);\n    },\n\n    deleteVar(index) {\n      this.modifiedVars.splice(index, 1);\n      this.$emit('change', this.modifiedVars);\n    },\n  },\n};\n</script>\n"]},"metadata":{},"sourceType":"module"}