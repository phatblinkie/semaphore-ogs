{"ast":null,"code":"import axios from 'axios';\nimport EventBus from '@/event-bus';\nimport EditDialog from '@/components/EditDialog.vue';\nimport YesNoDialog from '@/components/YesNoDialog.vue';\nimport ObjectRefsDialog from '@/components/ObjectRefsDialog.vue';\nimport { getErrorMessage } from '@/lib/error';\nimport { USER_PERMISSIONS } from '@/lib/constants';\nimport PermissionsCheck from '@/components/PermissionsCheck';\nexport default {\n  components: {\n    YesNoDialog,\n    EditDialog,\n    ObjectRefsDialog\n  },\n  mixins: [PermissionsCheck],\n  props: {\n    projectId: Number,\n    projectType: String,\n    userId: Number,\n    userRole: String,\n    user: Object\n  },\n  data() {\n    const allowActions = this.allowActions();\n    const headers = this.getHeaders().filter(header => allowActions || header.value !== 'actions');\n    return {\n      headers,\n      items: null,\n      itemId: null,\n      editDialog: null,\n      deleteItemDialog: null,\n      itemRefs: null,\n      itemRefsDialog: null,\n      USER_PERMISSIONS\n    };\n  },\n  async created() {\n    await this.beforeLoadItems();\n    await this.loadItems();\n  },\n  methods: {\n    allowActions() {\n      return this.can(USER_PERMISSIONS.manageProjectResources);\n    },\n    // eslint-disable-next-line no-empty-function\n    async beforeLoadItems() {},\n    getSingleItemUrl() {\n      throw new Error('Not implemented');\n    },\n    getHeaders() {\n      throw new Error('Not implemented');\n    },\n    getEventName() {\n      throw new Error('Not implemented');\n    },\n    showDrawer() {\n      EventBus.$emit('i-show-drawer');\n    },\n    async onItemSave() {\n      await this.loadItems();\n    },\n    async askDeleteItem(itemId) {\n      this.itemId = itemId;\n      try {\n        this.itemRefs = (await axios({\n          method: 'get',\n          url: `${this.getSingleItemUrl()}/refs`,\n          responseType: 'json'\n        })).data;\n        if (this.itemRefs.templates.length > 0 || this.itemRefs.repositories.length > 0 || this.itemRefs.inventories.length > 0 || this.itemRefs.schedules.length > 0) {\n          this.itemRefsDialog = true;\n          return;\n        }\n      } catch (e) {\n        // Do nothing\n      }\n      this.deleteItemDialog = true;\n    },\n    async deleteItem(itemId) {\n      try {\n        const item = this.items.find(x => x.id === itemId);\n        await axios({\n          method: 'delete',\n          url: this.getSingleItemUrl(),\n          responseType: 'json'\n        });\n        EventBus.$emit(this.getEventName(), {\n          action: 'delete',\n          item\n        });\n        await this.loadItems();\n      } catch (err) {\n        EventBus.$emit('i-snackbar', {\n          color: 'error',\n          text: getErrorMessage(err)\n        });\n      }\n    },\n    editItem(itemId) {\n      this.itemId = itemId;\n      this.editDialog = true;\n    },\n    async loadItems() {\n      this.items = (await axios({\n        method: 'get',\n        url: this.getItemsUrl(),\n        responseType: 'json'\n      })).data;\n    }\n  }\n};","map":{"version":3,"names":["axios","EventBus","EditDialog","YesNoDialog","ObjectRefsDialog","getErrorMessage","USER_PERMISSIONS","PermissionsCheck","components","mixins","props","projectId","Number","projectType","String","userId","userRole","user","Object","data","allowActions","headers","getHeaders","filter","header","value","items","itemId","editDialog","deleteItemDialog","itemRefs","itemRefsDialog","created","beforeLoadItems","loadItems","methods","can","manageProjectResources","getSingleItemUrl","Error","getEventName","showDrawer","$emit","onItemSave","askDeleteItem","method","url","responseType","templates","length","repositories","inventories","schedules","e","deleteItem","item","find","x","id","action","err","color","text","editItem","getItemsUrl"],"sources":["/home/admin/repos/semaphore-ogs/web/src/components/ItemListPageBase.js"],"sourcesContent":["import axios from 'axios';\nimport EventBus from '@/event-bus';\nimport EditDialog from '@/components/EditDialog.vue';\nimport YesNoDialog from '@/components/YesNoDialog.vue';\nimport ObjectRefsDialog from '@/components/ObjectRefsDialog.vue';\n\nimport { getErrorMessage } from '@/lib/error';\nimport { USER_PERMISSIONS } from '@/lib/constants';\nimport PermissionsCheck from '@/components/PermissionsCheck';\n\nexport default {\n  components: {\n    YesNoDialog,\n    EditDialog,\n    ObjectRefsDialog,\n  },\n\n  mixins: [PermissionsCheck],\n\n  props: {\n    projectId: Number,\n    projectType: String,\n    userId: Number,\n    userRole: String,\n    user: Object,\n  },\n\n  data() {\n    const allowActions = this.allowActions();\n\n    const headers = this.getHeaders().filter((header) => allowActions || header.value !== 'actions');\n\n    return {\n      headers,\n      items: null,\n\n      itemId: null,\n      editDialog: null,\n      deleteItemDialog: null,\n\n      itemRefs: null,\n      itemRefsDialog: null,\n\n      USER_PERMISSIONS,\n    };\n  },\n\n  async created() {\n    await this.beforeLoadItems();\n    await this.loadItems();\n  },\n\n  methods: {\n    allowActions() {\n      return this.can(USER_PERMISSIONS.manageProjectResources);\n    },\n\n    // eslint-disable-next-line no-empty-function\n    async beforeLoadItems() {\n    },\n\n    getSingleItemUrl() {\n      throw new Error('Not implemented');\n    },\n\n    getHeaders() {\n      throw new Error('Not implemented');\n    },\n\n    getEventName() {\n      throw new Error('Not implemented');\n    },\n\n    showDrawer() {\n      EventBus.$emit('i-show-drawer');\n    },\n\n    async onItemSave() {\n      await this.loadItems();\n    },\n\n    async askDeleteItem(itemId) {\n      this.itemId = itemId;\n\n      try {\n        this.itemRefs = (await axios({\n          method: 'get',\n          url: `${this.getSingleItemUrl()}/refs`,\n          responseType: 'json',\n        })).data;\n\n        if (this.itemRefs.templates.length > 0\n          || this.itemRefs.repositories.length > 0\n          || this.itemRefs.inventories.length > 0\n          || this.itemRefs.schedules.length > 0) {\n          this.itemRefsDialog = true;\n          return;\n        }\n      } catch (e) {\n        // Do nothing\n      }\n\n      this.deleteItemDialog = true;\n    },\n\n    async deleteItem(itemId) {\n      try {\n        const item = this.items.find((x) => x.id === itemId);\n\n        await axios({\n          method: 'delete',\n          url: this.getSingleItemUrl(),\n          responseType: 'json',\n        });\n\n        EventBus.$emit(this.getEventName(), {\n          action: 'delete',\n          item,\n        });\n\n        await this.loadItems();\n      } catch (err) {\n        EventBus.$emit('i-snackbar', {\n          color: 'error',\n          text: getErrorMessage(err),\n        });\n      }\n    },\n\n    editItem(itemId) {\n      this.itemId = itemId;\n      this.editDialog = true;\n    },\n\n    async loadItems() {\n      this.items = (await axios({\n        method: 'get',\n        url: this.getItemsUrl(),\n        responseType: 'json',\n      })).data;\n    },\n  },\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}